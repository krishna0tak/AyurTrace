<!DOCTYPE html>
<html>
<head>
    <title>QR Code Test</title>
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
</head>
<body>
    <h1>QR Code Generation Test</h1>
    <div id="qr-container"></div>
    <button onclick="generateQR()">Generate QR Code</button>
    
    <script>
        function waitForQRCode() {
            return new Promise((resolve) => {
                if (typeof QRCode !== 'undefined') {
                    console.log('QRCode found!');
                    resolve();
                } else {
                    console.log('QRCode not found, waiting...');
                    setTimeout(() => waitForQRCode().then(resolve), 100);
                }
            });
        }
        
        async function generateQR() {
            try {
                await waitForQRCode();
                console.log('Generating QR code...');
                
                const qrUrl = await QRCode.toDataURL('http://localhost:8000/search.html?serial=TEST-P001', {
                    width: 200,
                    margin: 2,
                    color: {
                        dark: '#000000',
                        light: '#FFFFFF'
                    }
                });
                
                document.getElementById('qr-container').innerHTML = `
                    <p>QR Code generated successfully!</p>
                    <img src="${qrUrl}" style="border: 1px solid #ccc;">
                    <p>Links to: search.html?serial=TEST-P001</p>
                `;
                
            } catch (error) {
                console.error('QR generation failed:', error);
                document.getElementById('qr-container').innerHTML = `
                    <p style="color: red;">QR generation failed: ${error.message}</p>
                `;
            }
        }
        
        // Test immediately when page loads
        window.addEventListener('DOMContentLoaded', async () => {
            try {
                await waitForQRCode();
                document.getElementById('qr-container').innerHTML = '<p style="color: green;">QRCode library loaded successfully!</p>';
            } catch (error) {
                document.getElementById('qr-container').innerHTML = '<p style="color: red;">QRCode library failed to load!</p>';
            }
        });
    </script>
</body>
</html>
